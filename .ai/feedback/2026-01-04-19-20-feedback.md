# フィードバック

- **日時**: 2026-01-04 19:20
- **内容**: https://meeting-dev.aidreams-factory.com/ で画像を生成させたけど画像が表示されずに何もエラーがなく終わってしまった
- **緊急度**: 高
- **分類**: bug
- **状態**: 未対応

## 詳細

### 再現手順

1. https://meeting-dev.aidreams-factory.com/ にアクセス
2. テキスト入力欄に内容を入力（例: 「- 文字起こし - LLMとタスク管理: 技術・課題・戦略検討 2025年12月26日」）
3. 生成枚数: 2枚、デザインスタイル: 標準 - バランス重視
4. 「インフォグラフィックを生成」ボタンをクリック
5. 処理完了後、画像が表示されずに終了

### 観察

- Network タブでは多くの fetch リクエストが 200 で成功
- フロントエンドにエラー表示なし
- 画像が表示されない

### 考えられる原因

1. 画像生成APIは成功しているがS3へのアップロードに失敗
2. S3キーの取得/表示に問題
3. 画像生成自体が失敗しているがエラーハンドリングが不足
4. 新しいプロンプトテンプレート適用による問題

## 対応メモ

### 根本原因（2026-01-04 19:25 調査完了）

CloudWatchログ調査により根本原因を特定:

```
[Image Generation] Gemini 3 Pro Image error: {"error":{"code":404,"message":"Publisher Model `projects/gen-lang-client-0174389307/locations/us-central1/publishers/google/models/gemini-3-pro-image-preview` was not found or your project does not have access to it."}}
```

**問題**: Gemini 3 Pro Image (`gemini-3-pro-image-preview`) は **グローバルリージョン** でのみ利用可能だが、コードでは `us-central1` を使用していた。

### 参考ドキュメント

- https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/3-pro-image
- Gemini 3 Pro Image は Vertex AI 経由で利用可能
- **リージョン: `global`** を指定する必要がある

### 修正内容

`src/services/gemini-client.ts` を修正:

```typescript
// Gemini 3 Pro Image はグローバルリージョンでのみ利用可能
const IMAGE_LOCATION = 'global';

// getGoogleGenAI() 内で IMAGE_LOCATION を使用
return new GoogleGenAI({
  vertexai: true,
  project: credentials.project_id || PROJECT_ID,
  location: IMAGE_LOCATION, // 'global' を使用
  googleAuthOptions: { credentials },
});
```

### 状態

- [x] 根本原因特定
- [x] コード修正完了
- [ ] テスト実行
- [ ] dev環境デプロイ
- [ ] 動作確認
