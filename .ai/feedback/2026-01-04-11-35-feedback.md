# フィードバック

- **日時**: 2026-01-04 11:35
- **内容**: 本番環境で画像生成時にGemini API 429エラー発生。`gemini-3-pro-image-preview` モデルの日次クォータが0で利用不可。
- **緊急度**: 高
- **分類**: bug
- **状態**: 対応済み

## エラー詳細

```
[GoogleGenerativeAI Error]: [429 Too Many Requests]
Quota exceeded for metric: generativelanguage.googleapis.com/generate_requests_per_model_per_day
limit: 0
```

## 原因分析

- 新しいAPIキー（AI Studio Tier 1）を設定済み
- しかし `gemini-3-pro-image-preview` モデルへのクォータが0
- このモデルは限定公開または特別なアクセス権が必要な可能性

## 対応メモ

### 対応完了 (2026-01-04)

複数の対策を実装:

1. **Gemini 3 Pro Image 優先使用** (commit `0b98d97`)
   - `GOOGLE_SERVICE_ACCOUNT_KEY` 使用時に Gemini 3 Pro Image を最優先
   - フォールバックチェーン: Gemini 3 Pro → Imagen 3 → Gemini 2.0 Flash

2. **サービスアカウントキー設定**
   - dev: `meeting-visualizer-dev/google-service-account-0GQTNe`
   - prod: `meeting-visualizer-prod/google-service-account-oXpPmm`
   - ECSタスク定義で `GOOGLE_SERVICE_ACCOUNT_KEY` 環境変数として注入

3. **レート制限対策**
   - 指数バックオフ (`calculateBackoffDelay`)
   - 連続レート制限時の追加待機
   - リトライロジック (最大3回)
