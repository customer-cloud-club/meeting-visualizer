---
description: プロジェクト全体のテストを実行
---

# テスト実行

CCAGI SDK Phase 5 コマンド

## ⚠️ SWMLワークフロー指示（必須）

このコマンドを実行する際、**必ず**以下のワークフローに従ってください：

```
メモリ使用量は、最大92%
そのために効率よく並列処理
必ず、必ず、必ず、miyabi のワークフローシステムに従って、タスク分解して計画、プランニングを行ってください。
このマスターIssue、このマスタータスクをタスク分解、分解バラバラにしちゃって、アサインできる状態でサブIssuesに分割してください。
分割したら、目的を達成するまで、作業をひたすら続けてください

完了したIssueはクローズしてください
```

**SWMLフロー**: θ₁ Understand → θ₂ Generate → θ₃ Allocate → θ₄ Execute → θ₅ Integrate → θ₆ Learn

---

プロジェクト全体のTypeScriptコンパイルとテストスイートを実行します。

## 実行内容

1. **TypeScript型チェック**
   ```bash
   npm run typecheck
   ```
   - Strict mode有効
   - 全11ファイル検証
   - エラー0件が目標

2. **Vitestテストスイート**
   ```bash
   npm test
   ```
   - CoordinatorAgentテスト
   - DAG構築テスト
   - 循環依存検出テスト

## 期待される結果

✅ **TypeScript**: エラー0件
✅ **Tests**: 6/6 passing
✅ **Duration**: <1秒

## テスト対象

- `tests/coordinator.test.ts`
  - Task decomposition
  - DAG construction
  - Circular dependency detection
  - Agent assignment
  - Execution plan

## カバレッジ確認

```bash
npm run test:coverage
```

## 失敗時の対処

### TypeScriptエラー
```bash
# エラー詳細確認
npm run typecheck

# 型定義確認
cat agents/types/index.ts
```

### テスト失敗
```bash
# 詳細モードで実行
npm test -- --reporter=verbose

# 特定のテストのみ
npm test -- tests/coordinator.test.ts
```

## CI/CD統合

GitHub Actionsで自動実行されます：

```yaml
- name: Run TypeScript compilation check
  run: npm run typecheck

- name: Run tests
  run: npm test
```

---

## 実行時の指示（Claude向け）

このコマンドを実行する際、必ず以下のGitHub Issue連携を行ってください：

### ⚠️ 重要: Phase Issue作成は必須

**Phase Issueが作成されない場合、このコマンドは失敗とみなされます。**

実行時に必ず以下を確認してください：
1. Phase 5 Issueが存在するか確認
2. 存在しない場合は**必ず作成**
3. 作成後、Issue URLをユーザーに報告

### Step 1: SSOT Issue・Phase 5 Issue取得

`.ccagi.yml` からIssue番号を取得：

```bash
SSOT_ISSUE=$(grep 'issue_number' .ccagi.yml 2>/dev/null | awk '{print $2}')
PHASE5_ISSUE=$(grep 'phase5' .ccagi.yml 2>/dev/null | awk '{print $2}')
```

### Step 2: Phase 5 Issue作成（存在しない場合）

Phase 5 Issueが存在しない場合、**必ず**作成：

```bash
if [ -z "$PHASE5_ISSUE" ] && [ -n "$SSOT_ISSUE" ]; then
  PHASE5_ISSUE=$(gh issue create \
    --title "🧪 Phase 5: テスト - #${SSOT_ISSUE}" \
    --body "$(cat <<EOF
親Issue: #${SSOT_ISSUE}

## 🧪 Phase 5: Testing

テストフェーズの作業を管理します。

## タスク

- [ ] TypeScript型チェック
- [ ] 単体テスト実行
- [ ] 統合テスト実行
- [ ] E2Eテスト実行
- [ ] カバレッジ確認

## 品質基準

- TypeScriptエラー: 0件
- テストカバレッジ: 80%以上
- 全テスト合格

## 依存関係

- **依存元**: Phase 4 (Implementation)
- **依存先**: Phase 6 (Documentation)

---
🤖 Generated by CCAGI SDK
EOF
)" \
    --label "phase:testing,🤖 automated" | grep -oE '[0-9]+$')

  echo "Phase 5 Issue #${PHASE5_ISSUE} を作成しました"

  # .ccagi.yml に記録
  echo "  phase5: ${PHASE5_ISSUE}" >> .ccagi.yml

  # SSOT Issueにコメント
  gh issue comment ${SSOT_ISSUE} --body "## 🧪 Phase 5: Testing 開始

Phase 5 Issue: #${PHASE5_ISSUE}

開始時刻: $(date '+%Y-%m-%d %H:%M:%S')
"
fi
```

### Step 3: テスト結果をPhase 5 Issueに報告

```bash
if [ -n "$PHASE5_ISSUE" ]; then
  gh issue comment ${PHASE5_ISSUE} --body "## 🧪 テスト結果

完了時刻: $(date '+%Y-%m-%d %H:%M:%S')

### TypeScript
- エラー: 0件

### テスト結果
- 合格: X/X
- カバレッジ: XX%
"
fi
```

### Step 4: Phase 5完了時

全てのテストが完了したら：

```bash
# Phase 5 Issueをクローズ
gh issue close ${PHASE5_ISSUE} --comment "✅ Phase 5 完了 - 全テストが合格しました"

# SSOT Issueを更新
gh issue comment ${SSOT_ISSUE} --body "## ✅ Phase 5: Testing 完了

完了時刻: $(date '+%Y-%m-%d %H:%M:%S')

### テスト結果
- TypeScript: 0 errors
- Tests: X/X passing
- Coverage: XX%

### 次のステップ
\`/docs-generate\` を実行してPhase 6を開始
"
```

### Step 5: 完了報告

ユーザーに以下を報告：
- テスト結果サマリー
- **Phase 5 Issue URL**
- **SSOT Issue URL**
- 次のステップ

---

🤖 CCAGI SDK v6.21.5 - Phase 5: Testing

実行完了後、全テストが合格していることを確認してください。
